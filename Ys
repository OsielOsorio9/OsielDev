from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
import logging

# ConfiguraciÃ³n bÃ¡sica
TOKEN = "7984414524:AAE0PKV5Twk1Asdxx8uIkew11QABF6SJPik"  # Â¡ReemplÃ¡zalo por tu token real!
ADMIN_ID = 123456789  # Cambia por tu ID de Telegram
UBICACION = {
    "latitud": 19.432608,  # Ejemplo: Coordenadas de CDMX
    "longitud": -99.133209
}

# Configura logging
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)

# MenÃº principal
keyboard_options = [["ğŸ“‹ Servicios", "ğŸ“· GalerÃ­a"], ["ğŸ“ Contacto", "ğŸ“ UbicaciÃ³n"]]

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        reply_markup = ReplyKeyboardMarkup(keyboard_options, resize_keyboard=True)
        await update.message.reply_text(
            "Â¡Hola! Soy el asistente de *CarpinterÃ­a XYZ* ğŸ› ï¸\n"
            "Â¿En quÃ© puedo ayudarte?",
            reply_markup=reply_markup,
            parse_mode="Markdown"
        )
    except Exception as e:
        logging.error(f"Error en start: {e}")

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        text = update.message.text
        
        if text == "ğŸ“‹ Servicios":
            await update.message.reply_text(
                "ğŸ”¨ *Nuestros servicios:*\n"
                "- Muebles a medida\n"
                "- Cocinas integrales\n"
                "- Puertas y ventanas\n"
                "- RestauraciÃ³n\n"
                "- DiseÃ±o personalizado\n\n"
                "ğŸ’¬ Â¿Quieres pedir un presupuesto? Escribe /presupuesto",
                parse_mode="Markdown"
            )
            
        elif text == "ğŸ“· GalerÃ­a":
            await update.message.reply_text("ğŸ” Mira nuestro trabajo en: [enlace_a_tu_galerÃ­a_o_red_social]")
            
        elif text == "ğŸ“ Contacto":
            await update.message.reply_text(
                "ğŸ“± *ContÃ¡ctanos:*\n"
                "Tel: 555-1234\n"
                "WhatsApp: [tu nÃºmero]\n"
                "Email: contacto@carpinteriaxyz.com",
                parse_mode="Markdown"
            )
            
        elif text == "ğŸ“ UbicaciÃ³n":
            await update.message.reply_location(
                latitude=UBICACION["latitud"],
                longitude=UBICACION["longitud"]
            )
            
    except Exception as e:
        logging.error(f"Error en handle_message: {e}")
        await update.message.reply_text("âš ï¸ OcurriÃ³ un error. Por favor intenta nuevamente.")

async def error_handler(update: object, context: ContextTypes.DEFAULT_TYPE):
    logging.error(f"Error global: {context.error}")

if __name__ == "__main__":
    try:
        app = Application.builder().token(TOKEN).build()
        
        # Comandos
        app.add_handler(CommandHandler("start", start))
        
        # Mensajes
        app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
        
        # Manejo de errores
        app.add_error_handler(error_handler)
        
        print("Bot iniciado. Presiona Ctrl+C para detener.")
        app.run_polling()
        
    except Exception as e:
        logging.critical(f"Error al iniciar el bot: {e}")
